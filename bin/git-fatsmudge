#!/usr/bin/env python


import sys
import shutil
import os
import os.path

prefix = sys.stdin.read(12)
if prefix == '#$# git-fat ':
    fname = sys.stdin.read(40)

    gitdir = os.environ.get('GIT_DIR')
    if gitdir is None:
        try:
            import subprocess as sub
            gitdir= sub.check_output('git rev-parse --git-dir'.split()).strip()
        except sub.CalledProcessError:
            raise RuntimeError('git-fat must be run from a git directory')

    fpath = os.path.join(gitdir,'fat','objects',fname)
    try:
        with open(fpath, 'rb') as f:
            shutil.copyfileobj(f, sys.stdout)
    except IOError:
        sys.stdout.write(prefix)
        sys.stdout.write(fname)
        shutil.copyfileobj(sys.stdin, sys.stdout)
        
else:
    sys.stdout.write(prefix)
    shutil.copyfileobj(sys.stdin, sys.stdout)
